<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Ella AI — Advanced fitness and wellness AI companion for gyms and personal coaching." />
  <meta name="keywords" content="fitness, wellness, AI, chatbot, gym, coaching" />
  <meta name="author" content="Ella AI Team" />
  <meta name="robots" content="index, follow" />
  <title>Ella AI — Enterprise Fitness & Wellness Assistant</title>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet" />
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #0a0a23;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      background-image:
        radial-gradient(circle at top left, #1f0f35 0%, transparent 50%),
        radial-gradient(circle at bottom right, #2b1648 0%, transparent 50%);
    }

    /* Username Display */
    #user-display {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      color: #00cc88;
      text-shadow: 0 0 5px rgba(0, 204, 136, 0.5);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    #logout-btn {
      background: transparent;
      border: 1px solid #00cc88;
      color: #00cc88;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.4rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    #logout-btn:hover, #logout-btn:focus {
      background: #00b377;
      color: #ffffff;
      box-shadow: 0 2px 10px rgba(0, 204, 136, 0.5);
      outline: none;
    }

    /* Auth Container (Login/Sign-Up) */
    #auth-container {
      width: 100%;
      max-width: 400px;
      background: rgba(18, 18, 39, 0.9);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    #login-box, #signup-box {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
    }
    #signup-box { display: none; } /* Hidden by default */
    #auth-container input {
      flex: 1;
      min-width: 120px;
      border-radius: 20px;
      border: 1px solid #00cc88;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      outline: none;
      color: #ffffff;
      background: #1c1c27;
      transition: border-color 0.3s ease;
    }
    #auth-container input:focus {
      border-color: #00ff99;
      box-shadow: 0 0 8px rgba(0, 204, 136, 0.3);
    }
    #auth-container input::placeholder {
      color: #b0c4ff;
      font-style: italic;
    }
    #auth-container button {
      background: #00cc88;
      color: #ffffff;
      font-weight: 600;
      border: none;
      border-radius: 20px;
      padding: 0.6rem 1.5rem;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 204, 136, 0.3);
      transition: all 0.3s ease;
    }
    #auth-container button:hover, #auth-container button:focus {
      background: #00b377;
      box-shadow: 0 4px 15px rgba(0, 204, 136, 0.5);
      outline: none;
    }
    #auth-container button:disabled {
      background: #005522;
      cursor: not-allowed;
      box-shadow: none;
    }
    .toggle-auth {
      background: transparent;
      border: none;
      color: #00cc88;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      text-decoration: underline;
      align-self: center;
      transition: color 0.3s ease;
      margin-top: 0.5rem;
      width: 100%;
      text-align: center;
    }
    .toggle-auth:hover, .toggle-auth:focus {
      color: #00b377;
      outline: none;
    }

    /* Header */
    header {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 2.5rem;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      color: #00cc88;
      text-shadow: 0 0 10px rgba(0, 204, 136, 0.5);
      user-select: none;
    }
    .slogan {
      font-family: 'Inter', sans-serif;
      font-size: 1.2rem;
      font-weight: 400;
      margin-bottom: 2rem;
      color: #b0c4ff;
      text-shadow: 0 0 5px rgba(106, 132, 255, 0.3);
    }

    /* Main Container */
    main {
      width: 100%;
      max-width: 1024px;
      background: rgba(18, 18, 39, 0.9);
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      padding: 2.5rem;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    /* Section Styling */
    section {
      background: #1c1c27;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: inset 0 0 10px rgba(0, 204, 136, 0.2);
    }
    section h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
      margin-bottom: 1.2rem;
      color: #00cc88;
      text-shadow: 0 0 10px rgba(0, 204, 136, 0.5);
    }

    /* Chatbot Container */
    #chatbot {
      background: #101017;
      border-radius: 12px;
      height: 500px;
      overflow-y: auto;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      font-family: 'Inter', monospace;
      font-size: 1rem;
      line-height: 1.6;
      color: #e0e0e0;
      scrollbar-width: thin;
      scrollbar-color: #00cc88 #1c1c27;
    }
    #chatbot::-webkit-scrollbar {
      width: 8px;
    }
    #chatbot::-webkit-scrollbar-thumb {
      background: #00cc88;
      border-radius: 4px;
    }
    #chatbot::-webkit-scrollbar-track {
      background: #1c1c27;
    }

    /* Message Styling */
    .message {
      max-width: 80%;
      padding: 0.8rem 1.2rem;
      border-radius: 20px;
      position: relative;
      word-break: break-word;
      animation: fadeIn 0.3s ease;
    }
    .user-message {
      align-self: flex-end;
      background: #00cc8855;
      color: #ffffff;
      text-align: right;
    }
    .bot-message {
      align-self: flex-start;
      background: #003322cc;
      color: #e0e0e0;
      text-align: left;
    }
    .timestamp {
      font-size: 0.75rem;
      opacity: 0.6;
      margin-top: 0.4rem;
      color: #b0c4ff;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      gap: 0.5rem;
      padding: 0.8rem 1.2rem;
    }
    .typing-indicator > div {
      width: 8px;
      height: 8px;
      background: #00cc88;
      border-radius: 50%;
      animation: blink 1.2s infinite ease-in-out;
    }
    .typing-indicator > div:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator > div:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0%, 80%, 100% { opacity: 0.3; }
      40% { opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Input Area */
    #input-area {
      margin-top: 1.5rem;
      display: flex;
      gap: 0.8rem;
    }
    #user-input {
      flex-grow: 1;
      border-radius: 30px;
      border: 1px solid #00cc88;
      padding: 0.9rem 1.5rem;
      font-size: 1rem;
      outline: none;
      color: #ffffff;
      background: #1c1c27;
      transition: border-color 0.3s ease;
    }
    #user-input:focus {
      border-color: #00ff99;
      box-shadow: 0 0 8px rgba(0, 204, 136, 0.3);
    }
    #user-input::placeholder {
      color: #b0c4ff;
      font-style: italic;
    }
    #send-btn {
      background: #00cc88;
      color: #ffffff;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      padding: 0.9rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 204, 136, 0.3);
      transition: all 0.3s ease;
    }
    #send-btn:hover, #send-btn:focus {
      background: #00b377;
      box-shadow: 0 4px 15px rgba(0, 204, 136, 0.5);
      outline: none;
    }
    #send-btn:disabled {
      background: #005522;
      cursor: not-allowed;
      box-shadow: none;
    }



    /* Clear Chat Button */
    #clear-chat {
      margin-top: 0.8rem;
      background: transparent;
      border: none;
      color: #00cc88;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      text-decoration: underline;
      align-self: flex-end;
      transition: color 0.3s ease;
    }
    #clear-chat:hover, #clear-chat:focus {
      color: #00b377;
      outline: none;
    }

    /* FAQ Styling */
    .faq-list {
      max-height: 450px;
      overflow-y: auto;
      font-size: 1rem;
      color: #e0e0e0;
      padding-right: 0.5rem;
    }
    .faq-item {
      margin-bottom: 1.5rem;
      border-bottom: 1px solid #2a2a3b;
      padding-bottom: 0.8rem;
    }
    .faq-question {
      font-weight: 600;
      color: #00cc88;
      margin-bottom: 0.4rem;
    }
    .faq-answer {
      font-weight: 400;
      color: #b0c4ff;
      line-height: 1.5;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body { padding: 1.5rem; }
      main { padding: 1.5rem; }
      header { font-size: 2rem; }
      #chatbot { height: 400px; }
      #user-input, #send-btn, #history-query, #history-btn { font-size: 0.95rem; }
      #auth-container { padding: 0.8rem; }
      #auth-container input, #auth-container button { font-size: 0.85rem; }
      #user-display { font-size: 0.9rem; }
    }
    @media (max-width: 480px) {
      header { font-size: 1.8rem; }
      .slogan { font-size: 1rem; }
      #chatbot { height: 350px; }
      #input-area, #history-container { flex-direction: column; }
      #user-input, #send-btn, #history-query, #history-btn { width: 100%; }
      #login-box, #signup-box { flex-direction: column; }
      #auth-container input, #auth-container button { width: 100%; min-width: auto; }
      #user-display { top: 0.5rem; right: 0.5rem; font-size: 0.8rem; }
    }
  </style>
</head>
<body>
  <!-- User Display -->
  <div id="user-display" style="display: none;">
    <span id="username"></span>
    <button id="logout-btn" onclick="logout()" aria-label="Log out">Logout</button>
  </div>

  <!-- Auth Container (Login/Sign-Up) -->
  <div id="auth-container" aria-label="User Authentication">
    <div id="login-box" aria-label="Login to Ella AI">
      <input type="email" id="email" placeholder="Email" aria-label="Enter your email" />
      <input type="password" id="password" placeholder="Password" aria-label="Enter your password" />
      <button onclick="login()" aria-label="Login">Login</button>
    </div>
    <div id="signup-box" aria-label="Sign Up for Ella AI">
      <input type="text" id="signup-username" placeholder="Username" aria-label="Choose your username" />
      <input type="email" id="signup-email" placeholder="Email" aria-label="Enter your email for sign-up" />
      <input type="password" id="signup-password" placeholder="Password" aria-label="Enter your password for sign-up" />
      <input type="password" id="confirm-password" placeholder="Confirm Password" aria-label="Confirm your password" />
      <button onclick="signup()" aria-label="Sign Up">Sign Up</button>
    </div>
    <button class="toggle-auth" onclick="toggleAuthMode()" id="toggle-auth">
      Need an account? Sign Up
    </button>
  </div>

  <header>Ella AI</header>
  <div class="slogan">Your Fitness & Wellness Companion</div>
  <main>
    <section aria-label="Chatbot Assistant Interface">
      <h2>Chat with Ella</h2>
      <div id="chatbot" role="log" aria-live="polite">
        <div class="bot-message message" aria-live="polite">
          Welcome! Ask me anything about fitness, wellness.
        </div>
           </div>
      <div id="history-container">
        <input type="text" id="history-query" placeholder="Search conversation history (e.g., 'workout')..." aria-label="Search conversation history" />
        <button id="history-btn" aria-label="Load conversation history">Load History</button>
      </div>
      <div id="input-area">
        <input
          type="text"
          id="user-input"
          placeholder="Chat here..."
          aria-label="Talk to Ella"
          autocomplete="off"
          autofocus
        />
        <button id="send-btn" aria-label="Send question">Send</button>
      </div>
      <button id="clear-chat" aria-label="Clear chat history">Clear Chat</button>
    </section>

    <section aria-label="Frequently Asked Questions">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-list" id="faq-list" tabindex="0" aria-live="polite">
        <!-- FAQ items dynamically loaded -->
      </div>
    </section>
  </main>

  <script>
    // FAQ Data
    const faqs = [
      {
        question: "What is the best way to build muscle?",
        answer: "Focus on progressive overload, consume 1.6–2.2g of protein per kg of body weight daily, prioritize rest, and maintain consistent workouts."
      },
      {
        question: "How much cardio should I do weekly?",
        answer: "Aim for 150 minutes of moderate-intensity or 75 minutes of vigorous aerobic exercise per week, adjusted to your goals."
      },
      {
        question: "What are the benefits of stretching?",
        answer: "Stretching improves flexibility, range of motion, injury prevention, and recovery."
      },
      {
        question: "How do I improve my running endurance?",
        answer: "Increase distance gradually, use interval training, cross-train, and prioritize recovery."
      },
      {
        question: "What nutrients are important for recovery?",
        answer: "Protein, carbohydrates, and hydration are key for muscle repair and glycogen replenishment."
      }
    ];

    // Utility: Format Timestamp
    function formatTimestamp(date) {
      const d = new Date(date);
      const h = d.getHours() % 12 || 12;
      const m = d.getMinutes().toString().padStart(2, '0');
      const ampm = d.getHours() >= 12 ? 'pm' : 'am';
      return `${h}:${m} ${ampm}`;
    }

    // Toggle Login/Sign-Up Forms
    function toggleAuthMode() {
      const loginBox = document.getElementById("login-box");
      const signupBox = document.getElementById("signup-box");
      const toggleBtn = document.getElementById("toggle-auth");
      if (loginBox.style.display !== "none") {
        loginBox.style.display = "none";
        signupBox.style.display = "flex";
        toggleBtn.textContent = "Already have an account? Login";
      } else {
        loginBox.style.display = "flex";
        signupBox.style.display = "none";
        toggleBtn.textContent = "Need an account? Sign Up";
      }
    }

    // Login Functionality
    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      if (!email || !password) {
        alert("Please fill in both fields");
        return;
      }
      try {
        const res = await fetch('https://ella-backend-uqu5.onrender.com/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (res.ok) {
          alert("Logged in!");
          document.getElementById("auth-container").style.display = "none";
          document.getElementById("user-display").style.display = "flex";
          document.getElementById("username").textContent = data.username;
          loadHistory(); // Load history after login
        } else {
          alert(data.message || "Login failed");
        }
      } catch (error) {
        alert("Error: Could not connect to server");
        console.error(error);
      }
    }

    // Sign-Up Functionality
    async function signup() {
      const username = document.getElementById("signup-username").value;
      const email = document.getElementById("signup-email").value;
      const password = document.getElementById("signup-password").value;
      const confirmPassword = document.getElementById("confirm-password").value;
      if (!username || !email || !password || !confirmPassword) {
        alert("Please fill in all fields");
        return;
      }
      if (password !== confirmPassword) {
        alert("Passwords do not match");
        return;
      }
      try {
        const res = await fetch('https://ella-backend-uqu5.onrender.com/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email, password, username })
        });
        const data = await res.json();
        if (res.ok) {
          alert("Sign-up successful! Please log in.");
          toggleAuthMode();
        } else {
          alert(data.message || "Sign-up failed");
        }
      } catch (error) {
        alert("Error: Could not connect to server");
        console.error(error);
      }
    }

    // Logout Functionality
    async function logout() {
      try {
        const res = await fetch('https://ella-backend-uqu5.onrender.com/logout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const data = await res.json();
        if (res.ok) {
          alert("Logged out!");
          document.getElementById("user-display").style.display = "none";
          document.getElementById("username").textContent = "";
          document.getElementById("auth-container").style.display = "block";
          document.getElementById("chatbot").innerHTML = `
            <div class="bot-message message" aria-live="polite">
              Welcome! Ask me anything about fitness, wellness, or coaching.
            </div>
          `;
        } else {
          alert(data.message || "Logout failed");
        }
      } catch (error) {
        alert("Error: Could not connect to server");
        console.error(error);
      }
    }

    // Check Login Status on Page Load
    let currentUserId = null;
    async function checkLoginStatus() {
      try {
        const res = await fetch('https://ella-backend-uqu5.onrender.com/whoami', {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const data = await res.json();
        if (res.ok) {
          document.getElementById("auth-container").style.display = "none";
          document.getElementById("user-display").style.display = "flex";
          document.getElementById("username").textContent = data.username;
          currentUserId = data.user_id;
          loadHistory(); // Load history on page load if logged in
        }
      } catch (error) {
        console.error("Error checking login status:", error);
      }
    }

    // Load FAQs
    const faqList = document.getElementById('faq-list');
    function loadFAQs() {
      faqList.innerHTML = '';
      faqs.forEach(({ question, answer }) => {
        const item = document.createElement('div');
        item.classList.add('faq-item');
        item.tabIndex = 0;
        item.innerHTML = `
          <div class="faq-question" aria-label="Question">${question}</div>
          <div class="faq-answer" aria-label="Answer">${answer}</div>
        `;
        faqList.appendChild(item);
      });
    }
    loadFAQs();

    // Chatbot Functionality
    const chatbot = document.getElementById('chatbot');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const clearBtn = document.getElementById('clear-chat');
    const historyQuery = document.getElementById('history-query');
    const historyBtn = document.getElementById('history-btn');

    // Append Message
    function appendMessage(text, sender = 'bot', timestamp = new Date()) {
      const message = document.createElement('div');
      message.classList.add('message', `${sender}-message`);
      message.innerHTML = `
        ${text}
        <div class="timestamp">${formatTimestamp(timestamp)}</div>
      `;
      chatbot.appendChild(message);
      chatbot.scrollTop = chatbot.scrollHeight;
    }

    // Load Chat History from Backend
    async function loadHistory() {
      try {
        const query = historyQuery.value.trim();
        const url = query ? `https://ella-backend-uqu5.onrender.com/history?query=${encodeURIComponent(query)}` : 'https://ella-backend-uqu5.onrender.com/history';
        const response = await fetch(url, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const data = await response.json();
        if (data.success) {
          chatbot.innerHTML = '';
          if (data.history.length === 0) {
            appendMessage('No conversation history found. Ask me about fitness, wellness, or coaching!', 'bot');
          } else {
            data.history.forEach(({ text, sender, timestamp }) => {
              appendMessage(text, sender, timestamp);
            });
          }
        } else {
          appendMessage(`Error loading history: ${data.message}`, 'bot');
        }
      } catch (error) {
        appendMessage('Error: Could not connect to server.', 'bot');
        console.error(error);
      }
    }

    // Show Typing Indicator
    function showTypingIndicator() {
      const indicator = document.createElement('div');
      indicator.classList.add('typing-indicator', 'bot-message');
      indicator.innerHTML = `<div></div><div></div><div></div>`;
      chatbot.appendChild(indicator);
      chatbot.scrollTop = chatbot.scrollHeight;
      return indicator;
    }

    // Remove Typing Indicator
    function removeTypingIndicator(indicator) {
      indicator.remove();
    }

    // Sanitize Input
    function sanitizeInput(input) {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    }

    // Backend Communication
    async function sendMessageToBackend(message) {
      try {
        const response = await fetch('https://ella-backend-uqu5.onrender.com/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            prompt: message,
            user_id: currentUserId || 'default',
            timestamp: new Date().toISOString()
          })
        });
        if (!response.ok) {
          throw new Error("Server returned an error");
        }
        const data = await response.json();
        return data.response || "No reply.";
      } catch (error) {
        console.error("Error connecting to backend:", error);
        return "Error: Could not connect to server.";
      }
    }

    // Handle Send Message
    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      const sanitizedText = sanitizeInput(text);
      sendBtn.disabled = true;
      appendMessage(sanitizedText, 'user', new Date());
      userInput.value = '';

      const indicator = showTypingIndicator();

      try {
        const response = await sendMessageToBackend(sanitizedText);
        setTimeout(() => {
          removeTypingIndicator(indicator);
          appendMessage(response, 'bot', new Date());
          sendBtn.disabled = false;
        }, 1000); // Simulated delay
      } catch (error) {
        removeTypingIndicator(indicator);
        appendMessage('Error: Could not connect to the server.', 'bot');
        sendBtn.disabled = false;
      }
    }

    // Clear Chat History
    async function clearChat() {
      try {
        const response = await fetch('https://ella-backend-uqu5.onrender.com/clear', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ user_id: currentUserId || 'default' })
        });
        const data = await response.json();
        if (data.status) {
          chatbot.innerHTML = '';
          appendMessage('Welcome! Ask me anything about fitness, wellness, or coaching.', 'bot');
        } else {
          appendMessage(`Error clearing history: ${data.error}`, 'bot');
        }
      } catch (error) {
        appendMessage('Error: Could not connect to server.', 'bot');
        console.error(error);
      }
    }

    // Event Listeners
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !sendBtn.disabled) sendMessage();
    });
    clearBtn.addEventListener('click', clearChat);
    historyBtn.addEventListener('click', loadHistory);
    historyQuery.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') loadHistory();
    });

    // Initialize
    checkLoginStatus();
  </script>
</body>
</html>
