<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Ella AI — Advanced fitness and wellness AI companion." />
  <meta name="keywords" content="fitness, wellness, AI, chatbot, gym, coaching" />
  <meta name="author" content="Ella AI Team" />
  <meta name="robots" content="index, follow" />
  <title>Ella — Enterprise Fitness & Wellness </title>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet" />
<style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      /* Dark background with subtle gradient */
      background: linear-gradient(135deg, #000000 0%, #0A1A33 100%);
      /* Subtle geometric dot pattern using yellow */
      background-image: radial-gradient(circle, rgba(255, 241, 27, 0.1) 2px, transparent 2px);
      background-size: 20px 20px;
      color: #16F1E4; /* Light blue for text */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
      /* Subtle animation for pattern movement */
      animation: shiftPattern 30s linear infinite;
    }

    @keyframes shiftPattern {
      0% { background-position: 0 0; }
      100% { background-position: 20px 20px; }
    }

    /* Header */
    header {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 2.5rem;
      letter-spacing: 0.1em;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      color: #FFF11B; /* Yellow for header */
      text-shadow: 0 0 8px rgba(255, 241, 27, 0.4);
      user-select: none;
    }

    .slogan {
      font-family: 'Inter', sans-serif;
      font-size: 1.2rem;
      font-weight: 400;
      margin-bottom: 2rem;
      color: #16F1E4; /* Light blue for slogan */
      text-shadow: 0 0 5px rgba(22, 241, 228, 0.3);
    }

    /* Main Container */
    main {
      width: 100%;
      max-width: 1024px;
      background: rgba(0, 0, 0, 0.85); /* Black with transparency */
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
      padding: 2.5rem;
      display: flex;
      flex-direction: column;
      gap: 2.5rem;
    }

    /* Section Styling */
    section {
      background: #000000; /* Black for sections */
      border-radius: 12px;
      padding: 2rem;
      box-shadow: inset 0 0 10px rgba(22, 241, 228, 0.2); /* Light blue shadow */
    }

    section h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
      margin-bottom: 1.2rem;
      color: #FFF11B; /* Yellow for headings */
      text-shadow: 0 0 8px rgba(255, 241, 27, 0.4);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body { padding: 1.5rem; }
      main { padding: 1.5rem; }
      header { font-size: 2rem; }
    }

    @media (max-width: 480px) {
      header { font-size: 1.8rem; }
      .slogan { font-size: 1rem; }
    }
</style>
</head>
<body>
  <header>Ella</header>
  <div class="slogan"> Your wellness companion </div>
  <main>
    <section aria-label="Chatbot Assistant Interface">
      <h2>Chat with Ella</h2>
      <div id="chatbot" role="log" aria-live="polite">
        <div class="bot-message message" aria-live="polite">
          How are you today?
        </div>
      </div>
    
      </div>
      <div id="input-area">
        <input
          type="text"
          id="user-input"
          placeholder="Chat here..."
          aria-label="Talk to Ella"
          autocomplete="off"
          autofocus
        />
        <button id="send-btn" aria-label="Send question">Send</button>
      </div>
      <button id="clear-chat" aria-label="Clear chat history">Clear Chat</button>
    </section>

    <section aria-label="Frequently Asked Questions">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-list" id="faq-list" tabindex="0" aria-live="polite">
        <!-- FAQ items dynamically loaded -->
      </div>
    </section>
  </main>

  <script>
    // FAQ Data
    const faqs = [
      {
        question: "What is the best way to build muscle?",
        answer: "Focus on progressive overload, consume 1.6–2.2g of protein per kg of body weight daily, prioritize rest, and maintain consistent workouts."
      },
      {
        question: "How much cardio should I do weekly?",
        answer: "Aim for 150 minutes of moderate-intensity or 75 minutes of vigorous aerobic exercise per week, adjusted to your goals."
      },
      {
        question: "What are the benefits of stretching?",
        answer: "Stretching improves flexibility, range of motion, injury prevention, and recovery."
      },
      {
        question: "How do I improve my running endurance?",
        answer: "Increase distance gradually, use interval training, cross-train, and prioritize recovery."
      },
      {
        question: "What nutrients are important for recovery?",
        answer: "Protein, carbohydrates, and hydration are key for muscle repair and glycogen replenishment."
      }
    ];

    // Utility: Format Timestamp
    function formatTimestamp(date) {
      const d = new Date(date);
      const h = d.getHours() % 12 || 12;
      const m = d.getMinutes().toString().padStart(2, '0');
      const ampm = d.getHours() >= 12 ? 'pm' : 'am';
      return `${h}:${m} ${ampm}`;
    }

    // Load FAQs
    const faqList = document.getElementById('faq-list');
    function loadFAQs() {
      faqList.innerHTML = '';
      faqs.forEach(({ question, answer }) => {
        const item = document.createElement('div');
        item.classList.add('faq-item');
        item.tabIndex = 0;
        item.innerHTML = `
          <div class="faq-question" aria-label="Question">${question}</div>
          <div class="faq-answer" aria-label="Answer">${answer}</div>
        `;
        faqList.appendChild(item);
      });
    }
    loadFAQs();

    // Chatbot Functionality
    const chatbot = document.getElementById('chatbot');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const clearBtn = document.getElementById('clear-chat');
    const historyQuery = document.getElementById('history-query');
    const historyBtn = document.getElementById('history-btn');

    // Append Message
    function appendMessage(text, sender = 'bot', timestamp = new Date()) {
      const message = document.createElement('div');
      message.classList.add('message', `${sender}-message`);
      message.innerHTML = `
        ${text}
        <div class="timestamp">${formatTimestamp(timestamp)}</div>
      `;
      chatbot.appendChild(message);
      chatbot.scrollTop = chatbot.scrollHeight;
    }

    // Load Chat History from Backend
    async function loadHistory() {
      try {
        const query = historyQuery.value.trim();
        const url = query ? `https://ella-backend-uqu5.onrender.com/history?query=${encodeURIComponent(query)}` : 'https://ella-backend-uqu5.onrender.com/history';
        const response = await fetch(url, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include'
        });
        const data = await response.json();
        if (data.success) {
          chatbot.innerHTML = '';
          if (data.history.length === 0) {
            appendMessage('No conversation history found. Ask me about fitness, wellness, or coaching!', 'bot');
          } else {
            data.history.forEach(({ text, sender, timestamp }) => {
              appendMessage(text, sender, timestamp);
            });
          }
        } else {
          appendMessage(`Error loading history: ${data.message}`, 'bot');
        }
      } catch (error) {
        appendMessage('Error: Could not connect to server.', 'bot');
        console.error(error);
      }
    }

    // Show Typing Indicator
    function showTypingIndicator() {
      const indicator = document.createElement('div');
      indicator.classList.add('typing-indicator', 'bot-message');
      indicator.innerHTML = `<div></div><div></div><div></div>`;
      chatbot.appendChild(indicator);
      chatbot.scrollTop = chatbot.scrollHeight;
      return indicator;
    }

    // Remove Typing Indicator
    function removeTypingIndicator(indicator) {
      indicator.remove();
    }

    // Sanitize Input
    function sanitizeInput(input) {
      const div = document.createElement('div');
      div.textContent = input;
      return div.innerHTML;
    }

    // Backend Communication
    async function sendMessageToBackend(message) {
      try {
        const response = await fetch('https://ella-backend-uqu5.onrender.com/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({
            prompt: message,
            user_id: 'default',
            timestamp: new Date().toISOString()
          })
        });
        if (!response.ok) {
          throw new Error("Server returned an error");
        }
        const data = await response.json();
        return data.response || "No reply.";
      } catch (error) {
        console.error("Error connecting to backend:", error);
        return "Error: Could not connect to server.";
      }
    }

    // Handle Send Message
    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      const sanitizedText = sanitizeInput(text);
      sendBtn.disabled = true;
      appendMessage(sanitizedText, 'user', new Date());
      userInput.value = '';

      const indicator = showTypingIndicator();

      try {
        const response = await sendMessageToBackend(sanitizedText);
        setTimeout(() => {
          removeTypingIndicator(indicator);
          appendMessage(response, 'bot', new Date());
          sendBtn.disabled = false;
        }, 1000); // Simulated delay
      } catch (error) {
        removeTypingIndicator(indicator);
        appendMessage('Error: Could not connect to the server.', 'bot');
        sendBtn.disabled = false;
      }
    }

    // Clear Chat History
    async function clearChat() {
      try {
        const response = await fetch('https://ella-backend-uqu5.onrender.com/clear', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ user_id: 'default' })
        });
        const data = await response.json();
        if (data.status) {
          chatbot.innerHTML = '';
          appendMessage('Welcome! Ask me anything about fitness, wellness, or coaching.', 'bot');
        } else {
          appendMessage(`Error clearing history: ${data.error}`, 'bot');
        }
      } catch (error) {
        appendMessage('Error: Could not connect to server.', 'bot');
        console.error(error);
      }
    }

    // Event Listeners
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !sendBtn.disabled) sendMessage();
    });
    clearBtn.addEventListener('click', clearChat);
    historyBtn.addEventListener('click', loadHistory);
    historyQuery.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') loadHistory();
    });
  </script>
</body>
</html>
